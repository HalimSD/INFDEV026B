\documentclass{beamer}
\usetheme[hideothersubsections]{HRTheme}
\usepackage{beamerthemeHRTheme}
\usepackage{graphicx}
\usepackage[space]{grffile}
\usepackage{listings}
\lstset{language=SQL,
basicstyle=\ttfamily\footnotesize,
mathescape=true,
keywordstyle=\color{blue},
breaklines=true}
\usepackage[utf8]{inputenc}
\usepackage{color}
\newcommand{\red}[1]{
\textcolor{red}{#1}
}
\newcommand{\ts}{\textbackslash}

\title{E-R model, Relational model, SQL}

\author{ }

\institute{Hogeschool Rotterdam \\ 
Rotterdam, Netherlands}

\date{}

\begin{document}
\maketitle

\SlideSection{Introduction}
\SlideSubSection{Lecture topics}
\begin{slide}{
\item E-R model.
\item Relational model.
\item SQL, and examples.
}\end{slide}

\SlideSection{E-R model}
\SlideSubSection{Overview}
\begin{slide}{
\item Highest level of database modelling.
\item Model the conceptual aspect of the database.
\item Far from the physical representation in the DBMS.
}\end{slide}

\SlideSubSection{Entity}
\begin{slide}{
\item Anything which can exist on its own on the database
\item Consider a database for a space shooter game
\item Starships, asteroids are entities, they have a meaning on their own

%insert picture here
}\end{slide}

\SlideSubSection{Attributes}
\begin{slide}{
\item They model characteristics of the entity.
\item \textbf{Starship:} velocity, shield, armour, weapon, [...]
\item \textbf{Asteroid:} velocity, mass, integrity, [...]

%insert picture here
}\end{slide}

\SlideSubSection{Relations}
\begin{slide}{
\item They describe the associations among entities (two or more).
\item They have a cardinality: number of participants for each side.

%insert picture here
}\end{slide}

\SlideSubSection{Relations - 1 : 1}
\begin{slide}{
\item Entity modelling a pilot and one modelling a starship.
\item Related by ``drives''.
\item The cardinality is 1:1 : one pilot drives at most one starship, and one starship can contain only one pilot.

%insert picture here
}\end{slide}

\SlideSubSection{Relations - 1 : N}
\begin{slide}{
\item Entity modelling a starship and one modelling a weapon.
\item Realted by ``mounted''
\item The cardinality is 1:N : a weapon can be mounted only on one starship, but a starship can mount more than one weapon.

%insert picture here
}\end{slide}

\SlideSubSection{Relations - N : M}
\begin{slide}{
\item Entity modelling a starship and one modelling an asteroid.
\item Realted by ``collides with''
\item The cardinality is N : M : several starships can collide with several asteroids.

%insert picture here
}\end{slide}

\SlideSubSection{Keys}
\begin{slide}{
\item A way to uniquely identify an entity.
\item A key is a set of attributes that have unique values among entities.
\item \textbf{Starship:} Serial number.

%insert picture here
}\end{slide}

\SlideSubSection{Weak entities}
\begin{slide}{
\item Entities which do not have a key attribute.
\item \textbf{Asteroids:} There can be two asteroids with the same position, same mass, velocity, etc.

%insert picture here
}\end{slide}

\SlideSection{Relational model}
\SlideSubSection{Overview}
\begin{slide}{
\item Halfway between a conceptual model and the physical model.
\item Contain an abstraction of physical elements.
\item Can be easily mapped to a physical implementation in a DBMS.
\item There are mapping rules from E-R model to the relational model.
}\end{slide}

\SlideSubSection{Relation}
\begin{slide}{
\item A relation is a collection of tuples.
\item Each element of a tuple is a value taken from an attribute set.
\item Each attribute set is identified by a name

\vspace{0.5cm}
\small
\begin{tabular}{|c|c|c|c|c|}
\hline
\multicolumn{5}{|c|}{\textbf{Ships}} \\
\hline
\underline{serial:number} & name:string & shields:integer & armour:integer & integrity:double precision \\
\hline
\end{tabular}

\vspace{0.5cm}
(38258269, "Battlestar Galactica", 3000, 5000, 1.0)
}\end{slide}

\SlideSubSection{Keys}
\begin{slide}{
\item A \textit{Primary key} is a set of attributes with unique values in each tuple.
\item A \textit{Candidate key} is the smallest set of attributes which form a primary key.

\vspace{0.5cm}
\textbf{Example:}\\
\textbf{Primary key:} (serial, name, shields) \\
\textbf{Candidate key:} (serial)
}\end{slide}

\SlideSubSection{Keys}
\begin{slide}{
\item A \textit{Primary key} is the chosen key for a relation among all the candidate keys.
\item A \textit{Foreign key} is a set of attributes in one relation which is a primary key in another relation.

\vspace{0.5cm}
\textbf{Example (Foreign key):}\\

\centering
\begin{tabular}{|c|c|}
\hline
\multicolumn{2}{|c|}{\textbf{Mounts}} \\
\hline
\underline{ship_serial:integer} & \underline{weapon_name:string} \\
\hline
\end{tabular}

\vspace{0.2cm}
\begin{tabular}{|c|c|c|c|c|}
\hline
\multicolumn{5}{|c|}{\textbf{Ships}} \\
\hline
\underline{serial:number} & name:string & shields:integer & armour:integer & integrity:double precision \\
\hline
\end{tabular}
\end{document}
\raggedright
\vspace{0.2cm}
In the relation \texttt{Mounts} the attribute \texttt{ship_serial} is a foreign key to \texttt{Ships}.
}\end{slide}


\SlideSection{SQL}
\SlideSubSection{Overview}
\begin{slide}{
\item Used to create relations (tables).
\item Used to insert/modify/extract data from relations (tables).
\item Declarative language (``What'' not ``How'').
}\end{slide}

\SlideSubSection{SELECT-FROM}
\begin{frame}[fragile]
\begin{tabular}{|c|c|c|c|c|}
\hline
\multicolumn{5}{|c|}{\textbf{Ships}} \\
\hline
\underline{serial:number} & name:string & shields:integer & armour:integer & integrity:double precision \\
\hline
\end{tabular}

\vspace{0.25cm}
\textbf{Select all ships from the game}
\pause
\begin{lstlisting}
SELECT *
FROM Ships
\end{lstlisting}

\end{frame}

\SlideSubSection{SELECT-FROM-WHERE (Selection)}
\begin{frame}[fragile]
\begin{tabular}{|c|c|c|c|c|}
\hline
\multicolumn{5}{|c|}{\textbf{Ships}} \\
\hline
\underline{serial:number} & name:string & shields:integer & armour:integer & integrity:double precision \\
\hline
\end{tabular}

\vspace{0.25cm}
\textbf{Select all ships in the game whose pilot is ``William Adama''}
\pause
\begin{lstlisting}
SELECT *
FROM Ships s
WHERE s.pilot = 'William Adama'
\end{lstlisting}

\end{frame}

\SlideSubSection{SELECT-FROM-WHERE (Projection)}
\begin{frame}[fragile]
\begin{tabular}{|c|c|c|c|c|}
\hline
\multicolumn{5}{|c|}{\textbf{Ships}} \\
\hline
\underline{serial:number} & name:string & shields:integer & armour:integer & integrity:double precision \\
\hline
\end{tabular}

\vspace{0.25cm}
\textbf{Find the name of the ships whose pilot is ``Starbucks''}
\pause
\begin{lstlisting}
SELECT s.Name
FROM Ship s
where s.pilot = 'Starbucks'
\end{lstlisting}

\end{frame}

\SlideSubSection{JOIN}
\begin{frame}[fragile]

\begin{tabular}{|c|c|c|c|c|}
\hline
\multicolumn{5}{|c|}{\textbf{Ships}} \\
\hline
\underline{serial:number} & name:string & shields:integer & armour:integer & integrity:double precision \\
\hline
\end{tabular}

\begin{tabular}{|c|c|}
\hline
\multicolumn{2}{|c|}{\textbf{Mounts}} \\
\hline
\underline{ship_serial:integer} & \underline{weapon_name:string} \\
\hline
\end{tabular}

\begin{tabular}{|c|c|c|}
\hline
\multicolumn{3}{|c|}{\textbf{Weapons}} \\
\hline
\underline{name:string} & damage:integer & type:string \\
\hline
\end{tabular}

\vspace{0.25cm}
\textbf{Find the serial of the ships mounting the weapon ``Stealthblade MKII''}
\pause
\begin{lstlisting}[showstringspaces=false]
SELECT s.serial
FROM Ships s, Mounts m
WHERE s.serial = m.ship_serial AND 
      m.weapon_name = 'Stealth Blade MKII'
\end{lstlisting}

\end{frame}

\SlideSubSection{JOIN (multiple tables)}
\begin{frame}[fragile]

\begin{tabular}{|c|c|c|c|c|}
\hline
\multicolumn{5}{|c|}{\textbf{Ships}} \\
\hline
\underline{serial:number} & name:string & shields:integer & armour:integer & integrity:double precision \\
\hline
\end{tabular}

\begin{tabular}{|c|c|}
\hline
\multicolumn{2}{|c|}{\textbf{Mounts}} \\
\hline
\underline{ship_serial:integer} & \underline{weapon_name:string} \\
\hline
\end{tabular}

\begin{tabular}{|c|c|c|}
\hline
\multicolumn{3}{|c|}{\textbf{Weapons}} \\
\hline
\underline{name:string} & damage:integer & type:string \\
\hline
\end{tabular}

\vspace{0.25cm}
\textbf{Find the name of all the weapons mounted in the ships flown by ``Apollo''}

\pause
\begin{lstlisting}[showstringspaces=false]
SELECT w.name
FROM Ships s, Mounts m, Weapons w
WHERE s.serial = m.ship_serial AND 
      m.weapon_name = w.name AND
      s.pilot = 'Apollo'
\end{lstlisting}

\end{frame}

\SlideSubSection{Aggregates (SUM)}
\begin{frame}[fragile]

\begin{tabular}{|c|c|c|c|c|}
\hline
\multicolumn{5}{|c|}{\textbf{Ships}} \\
\hline
\underline{serial:number} & name:string & shields:integer & armour:integer & integrity:double precision \\
\hline
\end{tabular}

\begin{tabular}{|c|c|}
\hline
\multicolumn{2}{|c|}{\textbf{Mounts}} \\
\hline
\underline{ship_serial:integer} & \underline{weapon_name:string} \\
\hline
\end{tabular}

\begin{tabular}{|c|c|c|}
\hline
\multicolumn{3}{|c|}{\textbf{Weapons}} \\
\hline
\underline{name:integer} & damage:integer & type:string \\
\hline
\end{tabular}

\vspace{0.25cm}
\textbf{Find the total damage output of the ships flown by ``Athena''}

\pause
\begin{lstlisting}[showstringspaces=false]
SELECT SUM(w.damage) AS damage
FROM Ships s, Mounts m, Weapons w
WHERE s.serial = m.ship_serial AND 
      m.weapon_name = w.name AND
      s.pilot = 'Athena'
\end{lstlisting}

\end{frame}

\SlideSubSection{Aggregates (COUNT, HAVING)}
\begin{frame}[fragile]

\begin{tabular}{|c|c|c|c|c|}
\hline
\multicolumn{5}{|c|}{\textbf{Ships}} \\
\hline
\underline{serial:number} & name:string & shields:integer & armour:integer & integrity:double precision \\
\hline
\end{tabular}

\begin{tabular}{|c|c|}
\hline
\multicolumn{2}{|c|}{\textbf{Mounts}} \\
\hline
\underline{ship_serial:integer} & \underline{weapon_name:string} \\
\hline
\end{tabular}

\begin{tabular}{|c|c|c|}
\hline
\multicolumn{3}{|c|}{\textbf{Weapons}} \\
\hline
\underline{name:integer} & damage:integer & type:string \\
\hline
\end{tabular}

\vspace{0.25cm}
\textbf{Count all the ships having more than 3 weapons}

\pause
\begin{lstlisting}[showstringspaces=false]
SELECT COUNT(*)
FROM (
 SELECT COUNT(*) AS ship_count
 FROM Ships s, Mounts m, Weapons w
 WHERE s.serial = m.ship_serial AND 
      m.weapon_name = w.name
 GROUP BY s.serial
 HAVING COUNT(*) > 3)
                   
\end{lstlisting}

\end{frame}

\end{document}

\begin{slide}{
\item ...
}\end{slide}

\begin{frame}[fragile]
\begin{lstlisting}
...
\end{lstlisting}
\end{frame}
